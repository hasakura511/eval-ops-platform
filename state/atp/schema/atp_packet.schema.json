{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/atp_packet.schema.json",
  "title": "ATP Packet",
  "type": "object",
  "required": [
    "ATP",
    "ID",
    "TS",
    "MODE",
    "TASK",
    "STATE",
    "PARENT",
    "ETAG",
    "TOOLS",
    "APPROVAL",
    "FAIL_CLASS",
    "goal",
    "now",
    "next",
    "risks",
    "accept",
    "artifacts",
    "questions"
  ],
  "additionalProperties": false,
  "properties": {
    "ATP": {
      "type": "string",
      "const": "ATP/0.1"
    },
    "ID": {
      "type": "string",
      "pattern": "^[^/]+/\\d{6}$"
    },
    "TS": {
      "type": "string",
      "format": "date-time"
    },
    "MODE": {
      "type": "string",
      "enum": ["PLAN", "EXEC", "REVIEW"]
    },
    "TASK": {
      "type": "string",
      "minLength": 1
    },
    "STATE": {
      "type": "string",
      "minLength": 1
    },
    "PARENT": {
      "type": ["string", "null"]
    },
    "ETAG": {
      "type": ["string", "null"]
    },
    "TOOLS": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 0
    },
    "APPROVAL": {
      "type": "string",
      "enum": ["none", "requested", "granted_by_human"]
    },
    "FAIL_CLASS": {
      "type": "string",
      "enum": ["NONE", "SPEC", "ENV", "TEST", "LOGIC", "INTEGRATION", "DATA", "TOOLING"]
    },
    "goal": {
      "type": "string",
      "minLength": 1
    },
    "now": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 0
    },
    "next": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 0
    },
    "risks": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 0
    },
    "accept": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 0
    },
    "artifacts": {
      "type": "object",
      "additionalProperties": false,
      "required": ["manifests"],
      "properties": {
        "manifests": {
          "type": "array",
          "items": {"type": "string"},
          "minItems": 0
        }
      }
    },
    "questions": {
      "type": "array",
      "items": {"type": "string"}
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1
    }
  }
}
